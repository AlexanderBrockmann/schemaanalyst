<project xmlns:jacoco="antlib:org.jacoco.ant">
	
	<!-- SETUP VARIABLES AND PATHS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

	<property name="lib.dir" value="lib" />
	<property name="src.dir" location="src" />
	<property name="build.dir" location="build" />
	<property name="dist.dir" location="dist" />
	<property name="dist.name" value="SchemaAnalyst" />
	<property name="config.dir" value="config" />
	<property name="run.dir" value="run" />
	<property name="databases.dir" value="databases" />

	<!-- Load the database configurations. -->
	<loadproperties>
		<file file="${config.dir}/databases.properties" />
	</loadproperties>

	<!-- The common classpath for building the system. -->
	<path id="build.classpath">
		<fileset dir="${lib.dir}" includes="*.jar" />
	</path>

	<!-- The classpath for running the system. -->
	<path id="run.classpath">
		<pathelement path="${build.dir}"/>
		<fileset dir="${lib.dir}" includes="*.jar"/>
	</path>
	

	<!-- BASIC TARGETS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

	<!-- CLEANING TASK - "ant clean" -->
	<target name="clean">
		<delete dir="${build.dir}"/>
		<delete dir="${dist.dir}"/>
		<delete dir="${run.dir}"/>
		<delete dir="${databases.dir}"/>
	</target>

	<!-- COMPILING TASK - "ant compile" -->  
	<target name="compile">
		<mkdir dir="${build.dir}"/>
		<javac srcdir="${src.dir}" destdir="${build.dir}" includeantruntime="false" debug="true" debuglevel="vars,lines,source">
			<classpath refid="build.classpath"/>
			<!-- <compilerarg value="-Xlint:unchecked"/> -->
		</javac>
	</target>

	<!-- JAR TASK - "ant jar" -->
	<target name="jar" depends="compile">
		<mkdir dir="${dist.dir}"/>
		<jar destfile="${dist.dir}/${dist.name}.jar" basedir="${build.dir}"/>
	</target>

	<!-- SETUP TASK - "ant setup" -->
	<target name="setup">
		<mkdir dir="${databases.dir}"/>
	</target>

	<!-- RUNNING TARGETS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

	<!-- RUNNING TASK - "ant schemaanalyst" -->
	<!-- Derby Server Port: 1527 -->
	<!-- Postgres Server Port: 5432 -->
	<!-- Possibilities for the search technique: -->
	<!-- alternatingvalue_defaults -->
	<!-- alternatingvalue -->
	<!-- random -->
	<!-- naiverandom -->
	<target name="schemaanalyst">
		<java fork="true" classname="org.schemaanalyst.SchemaAnalyst" maxmemory="1024m">
			<arg value="--debug=false" /> 
			<arg value="--foreignkeys=true" /> 
			<arg value="--script=true" /> 
			<arg value="--wantmutationreport_mrp=false" /> 
			<arg value="--wantmutationreport_txt=true" /> 
			<arg value="--onlymutationsummary=true" /> 
			<arg value="--datagenerator=alternatingvalue_defaults" /> 
			<arg value="--naiverandom_rowspertable=50" /> 
			<arg value="--naiverandom_maxtriespertable=1000" />
			<arg value="--satisfyrows=2" /> 
			<arg value="--negaterows=1" /> 
			<arg value="--maxevaluations=100000" /> 
			<arg value="--project=${user.dir}/" />
			<arg value="--type=${db.hsqldb}" />
			<arg value="--host=${db.hsqldb.host}" />
			<arg value="--port=${db.hsqldb.port}" />
			<arg value="--database=casestudy.Inventory" />
			<arg value="--scriptfile=casestudy.Inventory.sql" />
			<arg value="--mutantscriptfile=casestudy.Inventory.mutant.sql" />
			<arg value="--mutationreport_mrp=casestudy.Inventory.mrp" />
			<arg value="--mutationreport_txt=casestudy.hsqldb.Inventory.txt" />
			<classpath refid="run.classpath" />
		</java>
	</target>

	<!-- RUNNING TASK - "ant experiment" -->
	<target name="experiment">
		<junit fork="yes">
			<test name="experiment.AllExperiments" />
			<jvmarg value="-Dproject=${user.dir}" />
			<classpath refid="run.classpath" />
			<formatter type="brief" usefile="false" />
		</junit>
	</target>

	<!-- RUNNING TASK - "ant experimentToProperties" -->
	<target name="experimentToProperties">
		<delete dir="ExperimentsTasks"/>
		<mkdir dir="ExperimentTasks" />
		<junit fork="yes">
			<test name="experiment.ExperimentsToProperties" />
			<jvmarg value="-Dproject=${user.dir}" />
			<classpath refid="run.classpath" />
			<formatter type="brief" usefile="false" />
		</junit>
	</target>

	<!-- RUNNING TASK - "ant experimentFromProperties" -->
	<target name="experimentFromProperties">
		<java fork="true" classname="experiment.ExperimentFromProperties">
			<arg value="${uniqueid}" />
			<classpath refid="run.classpath" />
		</java>
	</target>

	<!-- RUNNING TASK - "ant globalexperimentparameters" -->
	<target name="globalexperimentparameters">
		<mkdir dir="${run.dir}" />
		<java fork="true" classname="experiment.GlobalExperimentParameters">
			<arg value="--project=${user.dir}" />
			<classpath refid="run.classpath" />
		</java>
	</target>

	<!-- RUNNING TASK - "ant localexperimentparameters" -->
	<target name="localexperimentparameters">
		<mkdir dir="${run.dir}" />
		<java fork="true" classname="experiment.LocalExperimentParameters">
			<arg value="--project=${user.dir}" />
			<classpath refid="run.classpath" />
		</java>
	</target>

	<!-- RUNNING TASK - "ant experimentparameters" -->
	<target name="experimentparameters">
		<antcall target="globalexperimentparameters"/>
		<antcall target="localexperimentparameters"/>
	</target>

</project>
